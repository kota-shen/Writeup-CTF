Compétences apprises lors du ctf

brute forcing
hash cracking
service enumeration
linux enumeration

Informations de bases

ip cible : 10.10.172.63

Pour débuter, j'effectue un scan TCP à la recherche des services ouverts sur la cible
## Scan Syn

`sudo nmap -sS -T4 -p- 10.10.172.63`

![[scan_syn.png]]

Je vois qu'il y a différents services connus tels que ssh, http, smb. J'effectue un scan plus poussé afin de trouver différentes informations supplémentaires (version, possible mauvaise configuration, ...)
## Scan Full

`sudo nmap -A -T4 -p 22,80,139,445,8009,8080 10.10.172.63`

![[scan_full1.png]]
![[scan_full2.png]]
![[scan_full3.png]]

Avec ce scan, je me rends compte qu'il y a une politique de sécurité du partage de fichiers,  je vais donc effectuer un scan nmap de vulnérabilité histoire de creuser de ce côté-là

## Scan Vuln

`sudo nmap --script *smb* -p 445 10.10.172.63`
![[scan_vuln3.png]]
![[scan_vuln1.png]]
![[scan_vuln2.png]]
![[scan_vuln3.png]]

Avec ce scan j'identifie que le partage est accessible en anonyme, allons jeter un oeil là dessus

![[smb1.png]]
![[smb2.png]]
![[smb3.png]]
![[staff_txt.png]]

En accédant au fichier présent sur le partage j'obtiens deux noms (Kay et Jan) D'après le message, Jan ne semble pas avoir de bonnes pratiques, je vais me concentrer sur lui afin d'accéder au système. 

Je recherche d'autres pistes potentielles pour effectuer mon attaque

Avec les scans nmap, je vois qu'il y a un serveur web, allons y faire un tour.

![[web1.png]]

j'effectue un scan gobuster pour énumérer les pages, et les dossiers potentiellement cachés.
## Gobuster

sudo gobuster dir -e -u http://10.10.172.63 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

![[gobuster.png]]

Il y a un dossier intéressant (/development) faisons un petit tour dessus.

![[web2.png]]

2 fichiers sont présents, j.txt semble être un fichier concernant jan.

![[web3.png]]

Effectivement, le contenu confirme mes suspicions, jan n'a pas de bonnes pratiques. Je tente un brute force avec hydra pour obtenir son mot de passe en ssh.

## Hydra

hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 6 ssh://10.10.172.63

![[hydra.png]]
Le scan hydra nous donne le mot de passe de jan et va nous permettre d'accéder au système en ssh

![[ssh1.png]]
![[ssh2.png]]
![[ssh3.png]]

> Ayant accédé au système via le partage nous avons déjà le second utilisateur demandé par Tryhackme, nous n'avons pas besoin d'utiliser enum4linux pour le découvrir.
> ![[enum4linux.png]]

![[ssh4.png]]

Je tente d'afficher le contenu de pass.bak

![[ssh6.png]]

N'ayant pas les droits, je continue l'investigation afin de trouver un moyen d'avoir les droits.

![[ssh5.png]]
En naviguant dans le système, j'accède au dossier .ssh et je vois qu'il y a la clé ssh de kay qui va me permettre de me connecter. Je la copie dans un fichier texte.

![[id_rsa.png]]
![[id_rsa2.png]]

J'utilise john the ripper pour récupérer le hash et le mot de passe de Kay

![[john.png]]
![[john2.png]]
Une fois le tout récupéré, je tente de me connecter en ssh à partir de la session de jan

ssh -i /home/kay/.ssh/id_rsa kay@10.10.172.63

![[kayssh1.png]]

Me voilà sur la session de Kay, il ne reste plus qu'à afficher le contenu de pass.bak

![[kayssh2.png]]

Maintenant que j'ai obtenu ce mot de passe je tente de me connecter en root.

![[root.png]]
Une fois en root, j'accède au dossier root du système

![[root2.png]]

Dans ce dossier, je vois qu'il y a un fichier flag. Affichons son contenu.

![[flag.png]]

Et voilà, j'ai réussi la mission. 

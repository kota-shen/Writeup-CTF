Compétences apprises lors du ctf

brute forcing
hash cracking
service enumeration
linux enumeration

Informations de bases

ip cible : 10.10.172.63

Pour débuter, j'effectue un scan TCP à la recherche des services ouverts sur la cible
## Scan Syn

`sudo nmap -sS -T4 -p- 10.10.172.63`

<a href="https://imgur.com/n29F0fN"><img src="https://i.imgur.com/n29F0fN.png" title="source: imgur.com" /></a>

Je vois qu'il y a différents services connus tels que ssh, http, smb. J'effectue un scan plus poussé afin de trouver différentes informations supplémentaires (version, possible mauvaise configuration, ...)
## Scan Full

`sudo nmap -A -T4 -p 22,80,139,445,8009,8080 10.10.172.63`

<a href="https://imgur.com/IFWexGo"><img src="https://i.imgur.com/IFWexGo.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/OFyt9XP"><img src="https://i.imgur.com/OFyt9XP.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/qKmiPJU"><img src="https://i.imgur.com/qKmiPJU.png" title="source: imgur.com" /></a>

Avec ce scan, je me rends compte qu'il y a une politique de sécurité du partage de fichiers,  je vais donc effectuer un scan nmap de vulnérabilité histoire de creuser de ce côté-là

## Scan Vuln

`sudo nmap --script *smb* -p 445 10.10.172.63`

<a href="https://imgur.com/KMojBcb"><img src="https://i.imgur.com/KMojBcb.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/yAoqowT"><img src="https://i.imgur.com/yAoqowT.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/XkOJVQo"><img src="https://i.imgur.com/XkOJVQo.png" title="source: imgur.com" /></a>

Avec ce scan j'identifie que le partage est accessible en anonyme et je remarque un fichier texte du nom de staff.txt, allons jeter un oeil là dessus

<a href="https://imgur.com/hTt87zT"><img src="https://i.imgur.com/hTt87zT.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/IlV6Gar"><img src="https://i.imgur.com/IlV6Gar.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/TA4Qd5q"><img src="https://i.imgur.com/TA4Qd5q.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/1NyoCVs"><img src="https://i.imgur.com/1NyoCVs.png" title="source: imgur.com" /></a>

En accédant au fichier présent sur le partage j'obtiens deux noms (Kay et Jan) D'après le message, Jan ne semble pas avoir de bonnes pratiques, je vais me concentrer sur lui afin d'accéder au système. 

Je recherche d'autres pistes potentielles pour effectuer mon attaque

Avec les scans nmap, je vois qu'il y a un serveur web, allons y faire un tour.

<a href="https://imgur.com/OecyagD"><img src="https://i.imgur.com/OecyagD.png" title="source: imgur.com" /></a>

j'effectue un scan gobuster pour énumérer les pages, et les dossiers potentiellement cachés.
## Gobuster

sudo gobuster dir -e -u http://10.10.172.63 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt

<a href="https://imgur.com/vlnjoIl"><img src="https://i.imgur.com/vlnjoIl.png" title="source: imgur.com" /></a>

Il y a un dossier intéressant (/development) faisons un petit tour dessus.

<a href="https://imgur.com/RULMwVR"><img src="https://i.imgur.com/RULMwVR.png" title="source: imgur.com" /></a>

2 fichiers sont présents, j.txt semble être un fichier concernant jan.

<a href="https://imgur.com/pojaZ5L"><img src="https://i.imgur.com/pojaZ5L.png" title="source: imgur.com" /></a>

Effectivement, le contenu confirme mes suspicions, jan n'a pas de bonnes pratiques. Je tente un brute force avec hydra pour obtenir son mot de passe en ssh.

## Hydra

hydra -l jan -P /usr/share/wordlists/rockyou.txt -t 6 ssh://10.10.172.63

<a href="https://imgur.com/AN3NHyI"><img src="https://i.imgur.com/AN3NHyI.png" title="source: imgur.com" /></a>
Le scan hydra nous donne le mot de passe de jan et va nous permettre d'accéder au système en ssh

<a href="https://imgur.com/VQCcBr9"><img src="https://i.imgur.com/VQCcBr9.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/KiSC3NT"><img src="https://i.imgur.com/KiSC3NT.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/Huwqdfi"><img src="https://i.imgur.com/Huwqdfi.png" title="source: imgur.com" /></a>

> Ayant accédé au système via le partage nous avons déjà le second utilisateur demandé par Tryhackme, nous n'avons pas besoin d'utiliser enum4linux pour le découvrir.
> <a href="https://imgur.com/Ypcg1h7"><img src="https://i.imgur.com/Ypcg1h7.png" title="source: imgur.com" /></a>

<a href="https://imgur.com/GnGzYLM"><img src="https://i.imgur.com/GnGzYLM.png" title="source: imgur.com" /></a>

Je tente d'afficher le contenu de pass.bak

<a href="https://imgur.com/tvnrfzb"><img src="https://i.imgur.com/tvnrfzb.png" title="source: imgur.com" /></a>

N'ayant pas les droits, je continue l'investigation afin de trouver un moyen d'avoir les droits.

<a href="https://imgur.com/NBZVATi"><img src="https://i.imgur.com/NBZVATi.png" title="source: imgur.com" /></a>
En naviguant dans le système, j'accède au dossier .ssh et je vois qu'il y a la clé ssh de kay qui va me permettre de me connecter. Je la copie dans un fichier texte.

<a href="https://imgur.com/ffCC8ID"><img src="https://i.imgur.com/ffCC8ID.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/qvlPkbH"><img src="https://i.imgur.com/qvlPkbH.png" title="source: imgur.com" /></a>

J'utilise john the ripper pour récupérer le hash et le mot de passe de Kay

<a href="https://imgur.com/JSthU8s"><img src="https://i.imgur.com/JSthU8s.png" title="source: imgur.com" /></a>
<a href="https://imgur.com/tNYw6p0"><img src="https://i.imgur.com/tNYw6p0.png" title="source: imgur.com" /></a>

Une fois le tout récupéré, je tente de me connecter en ssh à partir de la session de jan

ssh -i /home/kay/.ssh/id_rsa kay@10.10.172.63

<a href="https://imgur.com/NcUdfYt"><img src="https://i.imgur.com/NcUdfYt.png" title="source: imgur.com" /></a>

Me voilà sur la session de Kay, il ne reste plus qu'à afficher le contenu de pass.bak

<a href="https://imgur.com/x1nP1h9"><img src="https://i.imgur.com/x1nP1h9.png" title="source: imgur.com" /></a>

Maintenant que j'ai obtenu ce mot de passe je tente de me connecter en root.

<a href="https://imgur.com/1RiIP84"><img src="https://i.imgur.com/1RiIP84.png" title="source: imgur.com" /></a>
Une fois en root, j'accède au dossier root du système

<a href="https://imgur.com/MXqv9Sr"><img src="https://i.imgur.com/MXqv9Sr.png" title="source: imgur.com" /></a>

Dans ce dossier, je vois qu'il y a un fichier flag. Affichons son contenu.

<a href="https://imgur.com/FPIuz59"><img src="https://i.imgur.com/FPIuz59.png" title="source: imgur.com" /></a>

Et voilà, mission réussie. 
